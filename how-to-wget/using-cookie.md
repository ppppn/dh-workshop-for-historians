## ログインが必要なサイトからのダウンロード
### 1. ログインの必要なサイトに必要なCookie
今までは広く公開されていた画像データを収集しました。

しかし、サイトによってはログインが必要な場合もあります。法律や規約が許す限りにおいて、これらをダウンロードしたくなることも考えられます。

そのために、これまで用いてきた、パラメーターに加え Cookie という別の手段で情報を渡す必要が出てきます。

HTTPの基本的な通信は実はそれぞれが1回限りの通信で、次に接続した時には、前に接続したことをサーバーがすっかり忘れてしまっています。ステートレスと言います。
そのため、次に接続するときに、場合によっては、前に接続したときのことをサーバーに思い出させてあげる必要があります。それにCookieというものを利用します。

ログインの必要なサイトはこの場合に相当します。この場合、Cookieは書庫への入庫の際の入庫証だと思ってください。
書庫に入るとき、学生証を渡しますが、これがCookieに相当します(もちろん厳密には対応しません)。
図書館員は学生証を預かりますが、誰が入っているかは常に確認しているわけではありません(ステートレス)。入庫者は本を借りる時に、本と一緒に入庫証を図書館員に渡し、自分が入庫した者であることを伝え、貸出が終わったあと、入庫証を返却し、学生証と交換します。

同じことがHTTP通信にもいえるのです。
サーバーはクライアントのログインの際にCookieを発行します。このログイン用のCookieには特殊な値が書き込まれ、他人とは重複しません(ログイン情報のCookieが重複する場合、クラッキングに遭っていると言ってよいでしょう)。したがって、サーバーに対し、自分が誰であるかを示すことができ、サーバーもクライアントが何者かを把握することができます。このCookieで自分が誰かを証明できる期間を「セッション」と言います。
図書館の場合と異なるのは、Cookieには有効期限が設定されていることです。有効期限やログアウトなどにより、Cookieが失効した場合、Cookieの再発行が必要となりますが、ログイン情報の以前の値とは異なるものが振られます。したがって、セッションは別物として扱われます。

### 2. Cookieを取得する
さて、ログインした状態のCookieを取得しましょう。
さすがに、これだけはブラウザの力を頼らざるをえません。
Chrome互換(というと語弊がありますが)のChromiumをインストールします(パスワードを要求されたら入力してください):

```
$ sudo apt install chromium-browser
```

Chrome/ChromiumにはCookieを含めた wget コマンドを取得してくれる拡張機能があります。次のURLよりダウンロードしてください:

https://chrome.google.com/webstore/detail/kojiki/ccdgjjhapajgljlffamojdedkpkgneio?hl=ja&gl=JP

目的のサイトにログインしてみてください。
その後、ブラウザのどこかで右クリックし、 `kojiki` → `Copy wget this page` とクリックしてください。これで、そのページをダウンロードするためのパラメーターつきの `wget` コマンドが取得されます。
取得されたコマンドの `--header "(中身)"` がほしい部分です。
これをforループ内のwgetコマンドの後ろに貼り付ければ、ログインの必要なサイトから順次ダウンロードができるはずです。

### 3. Cookieはログインのたびに
Cookieは先程述べたとおり、失効すれば新たなものが発行されます。ログインを要求されたら、書き換えなければいけないと思って間違いないでしょう。また、そうでなくても、時間があけば、Cookieが変わっているということも、ありえます。ダウンロードできなくなったときは、使っていたCookieが使えなくなったかも、と疑ってかかる必要があります。